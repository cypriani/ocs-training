<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data Segregation :: OCS Training</title>
    <link rel="canonical" href="https://red-hat-storage.github.io/ocs-training/training/ocs4/ocs4-additionalfeatures-segregation.html">
    <meta name="generator" content="Antora 3.0.2">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LGCEEZGN54"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-LGCEEZGN54')</script>
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">
          <img src="../../_/img/header_logo_reverse.svg" height="40px" alt="Red Hat Data Services">
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Get Help</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage" target="_blank">OCS Documentation</a>
            <a class="navbar-item" href="https://bugzilla.redhat.com/describecomponents.cgi?product=Red%20Hat%20OpenShift%20Container%20Storage" target="_blank">Browse Bugs</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Improve Guides</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/red-hat-storage/ocs-training/blob/master/CONTRIBUTING.adoc" target="_blank">Guidelines</a>
            <a class="navbar-item" href="https://github.com/red-hat-storage/ocs-training/issues/new/choose" target="_blank">Open Issue</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Infos</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.redhat.com/en/blog/channel/red-hat-storage" target="_blank">Our Blog</a>
            <a class="navbar-item" href="https://www.youtube.com/channel/UCoyG8VyvB-XUxQl1mD3T3Gw" target="_blank">Youtube</a>
            <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">OCS Technology</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="training" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OCS Installation and Configuration</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="odf.html">ODF General deploy and use</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocs4-install-no-ui.html">OCS CLI based install</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="odf4-install-no-ui.html">ODF CLI based install</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocs4-encryption.html">External KMS Encryption</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocs4-enable-rgw.html">Use RGW in OCS deployment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocs4-cluster-storage-quotas.html">Cluster wide storage management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Disaster recovery</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="odf4-multisite-ramen.html">ODF 4.9 Regional disaster recovery</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="odf410-multisite-ramen.html">ODF 4.10 Regional disaster recovery</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocs4-metro-stretched.html">Stretch Cluster disaster recovery</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="odf410-metro-ramen.html">ODF 4.10 Metro disaster recovery</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="odf411-metro-ramen.html">ODF 4.11 Metro disaster recovery (WIP)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Development preview features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocs4-additionalfeatures-dbwal.html">BlueStore RocksDB metadata and WAL placement</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocs4-additionalfeatures-devtype.html">Mixed OSD device type configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ocs4-additionalfeatures-override.html">Ceph configuration override</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="ocs4-additionalfeatures-segregation.html">Data Segregation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../infra-nodes/ocs4-infra-nodes.html">Deploying on Infra nodes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ocs4perf/ocs4perf.html">Test deployment post-install</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OCS Installation and Configuration</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OCS Installation and Configuration</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../RegionalDR/index.html">ODF Regional DR</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../RegionalDR/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OCS Installation and Configuration</a></li>
    <li>Development preview features</li>
    <li><a href="ocs4-additionalfeatures-segregation.html">Data Segregation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/red-hat-storage/ocs-training/edit/master/training/modules/ocs4/pages/ocs4-additionalfeatures-segregation.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Data Segregation</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This feature is Development Preview.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This feature allows you to create a custom Ceph block pool to have the pool
only map to OSD that are in specific hosts or of a specific device type.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>1. Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The OpenShift Data Foundation operator has been installed and you also need the
Local Storage Operator. Note that this feature works with both dynamic provisioning
based deployments (e.g. AWS <code>gp2</code>) and LSO based deployments.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_label_nodes"><a class="anchor" href="#_label_nodes"></a>2. Label Nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step prior to deployment is to label your OpenShift Data Foundation nodes
with a specific label that will provide a placement tag for your device set. In the
example below we will use <code>set1</code> and <code>set2</code> to create 2 sets of nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ oc label nodes ip-10-0-133-24.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage-device-class=set1
node/ip-10-0-133-24.us-east-2.compute.internal labeled
$ oc label nodes ip-10-0-141-180.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage-device-class=set2
node/ip-10-0-141-180.us-east-2.compute.internal labeled
$ oc label nodes ip-10-0-184-165.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage-device-class=set1
node/ip-10-0-184-165.us-east-2.compute.internal labeled
$ oc label nodes ip-10-0-186-145.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage-device-class=set2
node/ip-10-0-186-145.us-east-2.compute.internal labeled
$ oc label nodes ip-10-0-209-55.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage-device-class=set1
node/ip-10-0-209-55.us-east-2.compute.internal labeled
$ oc label nodes ip-10-0-220-5.us-east-2.compute.internal cluster.ocs.openshift.io/openshift-storage-device-class=set2
node/ip-10-0-220-5.us-east-2.compute.internal labeled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply the standard OpenShift Data Foundation label to all worker nodes that will be part of the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">$ oc label node -l node-role.kubernetes.io/worker cluster.ocs.openshift.io/openshift-storage=''
node/ip-10-0-133-24.us-east-2.compute.internal labeled
node/ip-10-0-141-180.us-east-2.compute.internal labeled
node/ip-10-0-184-165.us-east-2.compute.internal labeled
node/ip-10-0-186-145.us-east-2.compute.internal labeled
node/ip-10-0-209-55.us-east-2.compute.internal labeled
node/ip-10-0-220-5.us-east-2.compute.internal labeled</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify your nodes are correctly labelled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc get nodes -L topology.kubernetes.io/zone,cluster.ocs.openshift.io/openshift-storage-device-class -l node-role.kubernetes.io/worker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME                                         STATUS   ROLES    AGE    VERSION           ZONE         OPENSHIFT-STORAGE-DEVICE-CLASS
ip-10-0-133-24.us-east-2.compute.internal    Ready    worker   139m   v1.21.1+051ac4f   us-east-2a   set1
ip-10-0-141-180.us-east-2.compute.internal   Ready    worker   139m   v1.21.1+051ac4f   us-east-2a   set2
ip-10-0-184-165.us-east-2.compute.internal   Ready    worker   141m   v1.21.1+051ac4f   us-east-2b   set1
ip-10-0-186-145.us-east-2.compute.internal   Ready    worker   141m   v1.21.1+051ac4f   us-east-2b   set2
ip-10-0-209-55.us-east-2.compute.internal    Ready    worker   141m   v1.21.1+051ac4f   us-east-2c   set1
ip-10-0-220-5.us-east-2.compute.internal     Ready    worker   141m   v1.21.1+051ac4f   us-east-2c   set2</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this document we use a Local Storage Operator based deployment on AWS. Each node is an <code>i3.4xlarge</code> instance
with 2 NVMe drives for each node.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_local_storage_operator_configuration"><a class="anchor" href="#_local_storage_operator_configuration"></a>3. Local Storage Operator Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Deploy the Local Storage Operator using the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">cat &lt;&lt;EOF | oc create -f -
---
apiVersion: v1
kind: Namespace
metadata:
  name: openshift-local-storage
spec: {}
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: local-operator-group
  namespace: openshift-local-storage
spec:
  targetNamespaces:
  - openshift-local-storage
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: local-storage-operator
  namespace: openshift-local-storage
spec:
  channel: "4.8"
  installPlanApproval: Automatic
  name: local-storage-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">namespace/openshift-local-storage created
operatorgroup.operators.coreos.com/local-operator-group created
subscription.operators.coreos.com/local-storage-operator created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify your operator is successfully deployed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc get csv -n openshift-local-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME                                        DISPLAY         VERSION              REPLACES   PHASE
local-storage-operator.4.8.0-202106291913   Local Storage   4.8.0-202106291913              Succeeded <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Operator deployment status</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only proceed to the next step when the status of the deployment is <code>Succeeded</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configure the Local Storage Operator to consume all available NVMes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">cat &lt;&lt;EOF | oc create -f -
---
apiVersion: local.storage.openshift.io/v1alpha1
kind: LocalVolumeDiscovery
metadata:
  name: auto-discover-devices
  namespace: openshift-local-storage
spec:
  nodeSelector:
    nodeSelectorTerms:
      - matchExpressions:
        - key: cluster.ocs.openshift.io/openshift-storage
          operator: In
          values:
            - ""
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">localvolumediscovery.local.storage.openshift.io/auto-discover-devices created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait for the <code>localvolumediscoveryresults</code> objects to be available.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc get localvolumediscoveryresults -n openshift-local-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME                                                          AGE
discovery-result-ip-10-0-133-24.us-east-2.compute.internal    27s
discovery-result-ip-10-0-141-180.us-east-2.compute.internal   27s
discovery-result-ip-10-0-184-165.us-east-2.compute.internal   27s
discovery-result-ip-10-0-186-145.us-east-2.compute.internal   27s
discovery-result-ip-10-0-209-55.us-east-2.compute.internal    27s
discovery-result-ip-10-0-220-5.us-east-2.compute.internal     27s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only proceed to the next step when the number of objects is equal to the number of
nodes labelled with <code>cluster.ocs.openshift.io/openshift-storage</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configure a <code>LocalVolumeSet</code> to create the PersistenVolumes that will be consumed by ODF.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">cat &lt;&lt;EOF | oc create -f -
---
apiVersion: local.storage.openshift.io/v1alpha1
kind: LocalVolumeSet
metadata:
  name: local-block
  namespace: openshift-local-storage
spec:
  nodeSelector:
    nodeSelectorTerms:
      - matchExpressions:
          - key: cluster.ocs.openshift.io/openshift-storage
            operator: In
            values:
              - ""
  storageClassName: localblock
  volumeMode: Block
  fstype: ext4
  maxDeviceCount: 2
  deviceInclusionSpec:
    deviceTypes:
    - disk
    deviceMechanicalProperties:
    - NonRotational</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">localvolumeset.local.storage.openshift.io/local-block created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait 60 seconds and verify the LSO PVs get created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc get pv | grep localblock</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">local-pv-1713478d   1769Gi     RWO            Delete           Available           localblock              7s
local-pv-1b5f29ce   1769Gi     RWO            Delete           Available           localblock              7s
local-pv-25362600   1769Gi     RWO            Delete           Available           localblock              6s
local-pv-322d07e    1769Gi     RWO            Delete           Available           localblock              6s
local-pv-38cab179   1769Gi     RWO            Delete           Available           localblock              6s
local-pv-4417fa00   1769Gi     RWO            Delete           Available           localblock              6s
local-pv-445859c3   1769Gi     RWO            Delete           Available           localblock              7s
local-pv-4ba9fc11   1769Gi     RWO            Delete           Available           localblock              6s
local-pv-58d7b728   1769Gi     RWO            Delete           Available           localblock              7s
local-pv-8317069a   1769Gi     RWO            Delete           Available           localblock              6s
local-pv-c2fa64b5   1769Gi     RWO            Delete           Available           localblock              6s
local-pv-c6855919   1769Gi     RWO            Delete           Available           localblock              6s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the environment used to illustrate this exercise we have a total of 12 local disk devices available
on the ODF labelled nodes.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should have as many PersistentVolumes as you have local disk devices. Wait until
all PersistentVolumes are created if the count is different!
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storage_cluster_configuration"><a class="anchor" href="#_storage_cluster_configuration"></a>4. Storage Cluster Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After installing the OpenShift Data Foundation Operator via OperatorHub. Deploy the OpenShift Data Foundation storage cluster using the following <code>CustomResource</code> file or equivalent based
on your exact configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">cat &lt;&lt;EOF | oc create -f -
---
apiVersion: ocs.openshift.io/v1
kind: StorageCluster
metadata:
  name: ocs-storagecluster
  namespace: openshift-storage
spec:
  monDataDirHostPath: /var/lib/rook
#
# Set 1 device set
#
  storageDeviceSets:
  - name: ssd-set1
    count: 6 <i class="conum" data-value="1"></i><b>(1)</b>
    replica: 1 <i class="conum" data-value="2"></i><b>(2)</b>
    deviceType: "ssd"
    deviceClass: "set1" <i class="conum" data-value="3"></i><b>(3)</b>
    dataPVCTemplate:
      spec:
        storageClassName: localblock <i class="conum" data-value="4"></i><b>(4)</b>
        accessModes:
        - ReadWriteOnce
        volumeMode: Block
        resources:
          requests:
            storage: 1 <i class="conum" data-value="5"></i><b>(5)</b>
    portable: false <i class="conum" data-value="6"></i><b>(6)</b>
#
# Schedule OSDs for this storageDeviceSet on node with the preset label
#
    placement:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: "cluster.ocs.openshift.io/openshift-storage-device-class"
              operator: In
              values:
              - "set1" <i class="conum" data-value="7"></i><b>(7)</b>
#
# Set 2 device set
#
  - name: ssd-set2
    count: 6
    replica: 1
    deviceType: "ssd"
    deviceClass: "set2"
    dataPVCTemplate:
      spec:
        storageClassName: localblock
        accessModes:
        - ReadWriteOnce
        volumeMode: Block
        resources:
          requests:
            storage: 1
    portable: false
#
# Schedule OSDs for this storageDeviceSet on node with the preset label
#
    placement:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: "cluster.ocs.openshift.io/openshift-storage-device-class"
              operator: In
              values:
              - "set2"
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Count is the number of replicas to deploy for this <code>storageDeviceSet</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Replica for this <code>storageDeviceSet</code> (how many OSDs to deploy each time <code>count</code> is increased by 1)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>CRUSH device class to be assigned the OSD within the <code>storageDeviceSet</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Storage class to use for the OSD PVCs in this <code>storageDeviceSet</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Minimum size to claim for the OSD PVC (1 byte)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>In our example we use local storage hence the OSDs are not portable</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Placement affinity specifies which label value to look for</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">storagecluster.ocs.openshift.io/ocs-storagecluster created</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>deviceClass</code> parameter allows you to override the <code>deviceType</code> parameter
described in the ODF 4.7 <a href="#ocs4-additionalfeatures.adoc#_mixed_osd_device_type_configuration" class="xref unresolved">ocs4-additionalfeatures.adoc#_mixed_osd_device_type_configuration</a> chapter.
As a result you can now choose customized character strings outside of the <code>hdd, ssd or nvme</code> options.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Wait for your cluster to be fully deployed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc get pod -n openshift-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME                                                              READY   STATUS      RESTARTS   AGE
csi-cephfsplugin-24z7g                                            3/3     Running     0          4m19s
csi-cephfsplugin-545pc                                            3/3     Running     0          4m19s
csi-cephfsplugin-89d2r                                            3/3     Running     0          4m19s
csi-cephfsplugin-fzckf                                            3/3     Running     0          4m19s
csi-cephfsplugin-provisioner-5dd599f584-h95ff                     6/6     Running     0          4m19s
csi-cephfsplugin-provisioner-5dd599f584-m8q8z                     6/6     Running     0          4m19s
csi-cephfsplugin-v6lrh                                            3/3     Running     0          4m19s
csi-cephfsplugin-v6wfk                                            3/3     Running     0          4m19s
csi-rbdplugin-52vfz                                               3/3     Running     0          4m20s
csi-rbdplugin-b9tsn                                               3/3     Running     0          4m20s
csi-rbdplugin-h9pkd                                               3/3     Running     0          4m20s
csi-rbdplugin-jbb55                                               3/3     Running     0          4m20s
csi-rbdplugin-pl7tc                                               3/3     Running     0          4m20s
csi-rbdplugin-provisioner-85b4b68989-4zlhg                        6/6     Running     0          4m20s
csi-rbdplugin-provisioner-85b4b68989-ghwj7                        6/6     Running     0          4m20s
csi-rbdplugin-vfptq                                               3/3     Running     0          4m20s
noobaa-core-0                                                     1/1     Running     0          2m32s
noobaa-db-pg-0                                                    1/1     Running     0          2m32s
noobaa-endpoint-5d6488db87-m5r6m                                  1/1     Running     0          49s
noobaa-operator-67786dd498-45ktn                                  1/1     Running     0          124m
ocs-metrics-exporter-795b66d6c5-qghx8                             1/1     Running     0          124m
ocs-operator-6fc4f459fb-bdlqs                                     1/1     Running     0          124m
rook-ceph-crashcollector-ip-10-0-133-24-6b98c55978-qk7pt          1/1     Running     0          3m2s
rook-ceph-crashcollector-ip-10-0-141-180-9cbdc6d98-dsmp2          1/1     Running     0          2m42s
rook-ceph-crashcollector-ip-10-0-184-165-6c94b557d8-scddp         1/1     Running     0          2m33s
rook-ceph-crashcollector-ip-10-0-186-145-67798f4888-r8chx         1/1     Running     0          3m1s
rook-ceph-crashcollector-ip-10-0-209-55-7dbfb485f4-9k9jt          1/1     Running     0          2m54s
rook-ceph-mds-ocs-storagecluster-cephfilesystem-a-676fd48874ltd   2/2     Running     0          2m11s
rook-ceph-mds-ocs-storagecluster-cephfilesystem-b-79dd8bf9rjtpf   2/2     Running     0          2m10s
rook-ceph-mgr-a-5cc898c4bc-xxm6w                                  2/2     Running     0          3m10s
rook-ceph-mon-a-6fb6d9775c-xhtxw                                  2/2     Running     0          3m53s
rook-ceph-mon-b-dbb555bd4-s2h5h                                   2/2     Running     0          3m42s
rook-ceph-mon-c-858ffd4f5-69z4q                                   2/2     Running     0          3m24s
rook-ceph-operator-759d8c4b4c-xhtmc                               1/1     Running     0          124m
rook-ceph-osd-0-597596cdb8-5k4gn                                  2/2     Running     0          7m26s
rook-ceph-osd-1-59b6b8f94b-hk9qs                                  2/2     Running     0          7m25s
rook-ceph-osd-10-5f58667698-crgqs                                 2/2     Running     0          61s
rook-ceph-osd-11-df6479cb9-kvzvh                                  2/2     Running     0          61s
rook-ceph-osd-2-5b8bb7bb4b-cjsp6                                  2/2     Running     0          7m24s
rook-ceph-osd-3-7b9b85d9c8-g4xgh                                  2/2     Running     0          7m24s
rook-ceph-osd-4-664b589f9d-bxj8f                                  2/2     Running     0          7m24s
rook-ceph-osd-5-675f87f9b8-ptz6z                                  2/2     Running     0          7m15s
rook-ceph-osd-6-76b4cc899c-v6h86                                  2/2     Running     0          72s
rook-ceph-osd-7-74c6488f6b-m42d9                                  2/2     Running     0          72s
rook-ceph-osd-8-867dbc6fd8-ng6qx                                  2/2     Running     0          72s
rook-ceph-osd-9-6fdfc7698c-wbbsd                                  2/2     Running     0          70s
rook-ceph-osd-prepare-ssd-set1-0-data-07m4ql-w5c5s                0/1     Completed   0          7m45s
rook-ceph-osd-prepare-ssd-set1-0-data-1frdkz-jtgbz                0/1     Completed   0          7m45s
rook-ceph-osd-prepare-ssd-set1-0-data-2mslwh-58r7x                0/1     Completed   0          7m45s
rook-ceph-osd-prepare-ssd-set1-0-data-387vpx-zvb46                0/1     Completed   0          92s
rook-ceph-osd-prepare-ssd-set1-0-data-4n6rtc-mdl6t                0/1     Completed   0          92s
rook-ceph-osd-prepare-ssd-set1-0-data-55gm4c-c65mb                0/1     Completed   0          91s
rook-ceph-osd-prepare-ssd-set2-0-data-0pr4ms-d8frs                0/1     Completed   0          7m44s
rook-ceph-osd-prepare-ssd-set2-0-data-1hrrpt-fbsvq                0/1     Completed   0          7m44s
rook-ceph-osd-prepare-ssd-set2-0-data-2ff7p5-mrmh2                0/1     Completed   0          7m43s
rook-ceph-osd-prepare-ssd-set2-0-data-3mvtsm-2mtkm                0/1     Completed   0          91s
rook-ceph-osd-prepare-ssd-set2-0-data-4fdbf5-s45b6                0/1     Completed   0          91s
rook-ceph-osd-prepare-ssd-set2-0-data-5zdcvs-27n6x                0/1     Completed   0          90s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify your cluster is fully operational and in healthy status using the ODF <strong>toolbox</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc patch OCSInitialization ocsinit -n openshift-storage --type json --patch  '[{ "op": "replace", "path": "/spec/enableCephTools", "value": true }]'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ocsinitialization.ocs.openshift.io/ocsinit patched</code></pre>
</div>
</div>
<div class="paragraph">
<p>Connect to the <strong>toolbox</strong> pod.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">TOOLS_POD=$(oc get pods -n openshift-storage -l app=rook-ceph-tools -o name)
oc rsh -n openshift-storage $TOOLS_POD</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once inside the <strong>toolbox</strong>, check the status of the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">sh-4.4# ceph -s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">  cluster:
    id:     4dc85b62-d688-45cc-9224-74005839e500
    health: HEALTH_OK <i class="conum" data-value="1"></i><b>(1)</b>

  services:
    mon: 3 daemons, quorum a,b,c (age 7m)
    mgr: a(active, since 7m)
    mds: ocs-storagecluster-cephfilesystem:1 {0=ocs-storagecluster-cephfilesystem-a=up:active} 1 up:standby-replay
    osd: 12 osds: 12 up (since 32s), 12 in (since 32s)

  data:
    pools:   3 pools, 288 pgs
    objects: 99 objects, 132 MiB
    usage:   12 GiB used, 21 TiB / 21 TiB avail
    pgs:     288 active+clean <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ceph cluster general health status</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Total number of Placement Groups in your cluster</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The status of your cluster should be <code>HEAKTH_OK</code>. <strong>If it is not</strong>, something went wrong and you will need
to troubleshoot your deployment before you can continue.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Write down the total number of Placement Groups present in the cluster after deployment. In the example
above, the value is <strong>288</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next step is to identify which OSDs belong to <code>set1</code> and to <code>set2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ceph osd tree</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ID  CLASS WEIGHT   TYPE NAME                        STATUS REWEIGHT PRI-AFF
 -1       20.73596 root default
 -6       20.73596     region us-east-2
 -5        6.91199         zone us-east-2a
 -4        3.45599             host ip-10-0-133-24
  0  set1  1.72800                 osd.0                up  1.00000 1.00000 <i class="conum" data-value="1"></i><b>(1)</b>
  1  set1  1.72800                 osd.1                up  1.00000 1.00000 <i class="conum" data-value="1"></i><b>(1)</b>
-19        3.45599             host ip-10-0-141-180
  4  set2  1.72800                 osd.4                up  1.00000 1.00000 <i class="conum" data-value="2"></i><b>(2)</b>
  8  set2  1.72800                 osd.8                up  1.00000 1.00000 <i class="conum" data-value="2"></i><b>(2)</b>
-14        6.91199         zone us-east-2b
-22        3.45599             host ip-10-0-184-165
  5  set1  1.72800                 osd.5                up  1.00000 1.00000 <i class="conum" data-value="1"></i><b>(1)</b>
  9  set1  1.72800                 osd.9                up  1.00000 1.00000 <i class="conum" data-value="1"></i><b>(1)</b>
-13        3.45599             host ip-10-0-186-145
  2  set2  1.72800                 osd.2                up  1.00000 1.00000 <i class="conum" data-value="2"></i><b>(2)</b>
  3  set2  1.72800                 osd.3                up  1.00000 1.00000 <i class="conum" data-value="2"></i><b>(2)</b>
-26        6.91199         zone us-east-2c
-25        3.45599             host ip-10-0-209-55
  6  set1  1.72800                 osd.6                up  1.00000 1.00000 <i class="conum" data-value="1"></i><b>(1)</b>
  7  set1  1.72800                 osd.7                up  1.00000 1.00000 <i class="conum" data-value="1"></i><b>(1)</b>
-31        3.45599             host ip-10-0-220-5
 10  set2  1.72800                 osd.10               up  1.00000 1.00000 <i class="conum" data-value="2"></i><b>(2)</b>
 11  set2  1.72800                 osd.11               up  1.00000 1.00000 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>CLASS</code> column indicates OSD has a CRUSH device class set to <code>set1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>CLASS</code> column indicates OSD has a CRUSH device class set to <code>set2</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this particular environment here are the respectives OSD IDs for each set:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>set1</code> OSDs are : 0, 1, 5, 6, 7, 9</p>
</li>
<li>
<p><code>set2</code> OSDs are : 2, 3, 4, 8, 10, 11</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Disconnect from the <strong>toolbox</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next step is to create a custom <strong>cephblockpool</strong> that only uses the OSDs that belong to <code>set1</code>.
This means that all Placement Groups for the pool will be mapped to OSDs with ID 0, 1, 5, 6, 7 or 9.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">cat &lt;&lt;EOF | oc create -f -]
---
apiVersion: ceph.rook.io/v1
kind: CephBlockPool
metadata:
  name: ssd-set1-pool <i class="conum" data-value="1"></i><b>(1)</b>
  namespace: openshift-storage
spec:
  failureDomain: zone <i class="conum" data-value="2"></i><b>(2)</b>
  replicated:
    size: 3 <i class="conum" data-value="3"></i><b>(3)</b>
    requireSafeReplicaSize: true
  deviceClass: set1 <i class="conum" data-value="4"></i><b>(4)</b>
  mirroring:
    enabled: false
    mode: image
  statusCheck:
    mirror:
      disabled: false
      interval: 60s</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom pool name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Failure domain to use for the CRUSH rule assigned to the pool</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Size parameter to assign to the pool</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Device class to use for the CRUSH rule assigned to the pool</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cephblockpool.ceph.rook.io/ssd-set1-pool created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify the CR has been created successfully.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc get cephblockpool -n openshift-storage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME                               AGE
ocs-storagecluster-cephblockpool   15m
ssd-set1-pool                      22s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We see that we now have 2 <code>cephblockpool</code> CRs. The default one <code>ocs-storagecluster-cephblockpool</code>,
created during the deployment of the cluster and one for our new test pool <code>ssd-set1-pool</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s get back into the <strong>toolbox</strong> pod and check the status of the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc rsh -n openshift-storage $TOOLS_POD</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify the status of the cluster and check the total number of Placement Groups present in the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ceph -s</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">  cluster:
    id:     4dc85b62-d688-45cc-9224-74005839e500
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum a,b,c (age 37m)
    mgr: a(active, since 37m)
    mds: ocs-storagecluster-cephfilesystem:1 {0=ocs-storagecluster-cephfilesystem-a=up:active} 1 up:standby-replay
    osd: 12 osds: 12 up (since 30m), 12 in (since 30m)

  data:
    pools:   4 pools, 320 pgs
    objects: 92 objects, 138 MiB
    usage:   12 GiB used, 21 TiB / 21 TiB avail
    pgs:     320 active+clean <i class="conum" data-value="1"></i><b>(1)</b>

  io:
    client:   852 B/s rd, 2.3 KiB/s wr, 1 op/s rd, 0 op/s wr</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Total number of Placement Groups in your cluster</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this example, the total number of Placement Group is now <strong>320</strong>. The original number before the creation
of the additional pool was <strong>288</strong>. This tells us the new pool has <strong>32</strong> Placement Groups.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now check the specific Ceph pool we have created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ceph osd pool ls detail</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">pool 1 'ocs-storagecluster-cephblockpool' replicated size 3 min_size 2 crush_rule 1 object_hash rjenkins pg_num 128 pgp_num 128 autoscale_mode on last_change 46 lfor 0/0/28 flags hashpspool,selfmanaged_snaps stripe_width 0 compression_mode none target_size_ratio 0.49 application rbd
	removed_snaps [1~3]
pool 2 'ocs-storagecluster-cephfilesystem-metadata' replicated size 3 min_size 2 crush_rule 2 object_hash rjenkins pg_num 32 pgp_num 32 autoscale_mode on last_change 25 flags hashpspool stripe_width 0 compression_mode none pg_autoscale_bias 4 pg_num_min 16 recovery_priority 5 application cephfs
pool 3 'ocs-storagecluster-cephfilesystem-data0' replicated size 3 min_size 2 crush_rule 3 object_hash rjenkins pg_num 128 pgp_num 128 autoscale_mode on last_change 46 lfor 0/0/28 flags hashpspool stripe_width 0 compression_mode none target_size_ratio 0.49 application cephfs
pool 4 'ssd-set1-pool' replicated size 3 min_size 2 crush_rule 4 object_hash rjenkins pg_num 32 pgp_num 32 autoscale_mode on last_change 83 flags hashpspool stripe_width 0 compression_mode none application rbd <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The custom pool created as an example</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Write down the ID of the new pool (column 2) for the new pool <code>ssd-set1-pool</code> we have created (column 3).
In this example our pool ID is <strong>4</strong>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also check the CRUSH rule ID in column 10 for the new pool. In our example it is <strong>4</strong> (<code>crush_rule 4</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now verify the CRUSH rule that was generated for the new pool.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Rook operator always creates a CRUSH rule with the same name as the pool name
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ceph osd crush rule dump ssd-set1-pool</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">{
    "rule_id": 4, <i class="conum" data-value="1"></i><b>(1)</b>
    "rule_name": "ssd-set1-pool", <i class="conum" data-value="2"></i><b>(2)</b>
    "ruleset": 4,
    "type": 1,
    "min_size": 1,
    "max_size": 10,
    "steps": [
        {
            "op": "take",
            "item": -2,
            "item_name": "default~set1"	<i class="conum" data-value="3"></i><b>(3)</b>
        },
        {
            "op": "chooseleaf_firstn",
            "num": 0,
            "type": "zone" <i class="conum" data-value="4"></i><b>(4)</b>
        },
        {
            "op": "emit"
        }
    ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Matches the ID in the <code>ceph osd pool ls detail</code> command above</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The rule name is generated based on the pool name</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Rule uses device of type <code>set1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Failure domain is set to <code>zone</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now verify that all the Placement Groups for the custom pool are mapped to the correct OSDs.</p>
</div>
<div class="paragraph">
<p>The first step is to verify what we are looking for by inspecting one and only one Placement Group
for the new pool.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ceph pg dump | grep '^4.' | head -1
                      <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">4.b           0                  0        0         0       0       0           0          0   0        0 active+clean 2021-08-02 21:40:11.496593     0'0    82:12  [7,1,5]           7  [7,1,5]              7        0'0 2021-08-02 21:40:10.466388             0'0 2021-08-02 21:40:10.466388             0
                                                                                                                                                                       <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In the <code>grep</code> command above the number <strong>4</strong> is the ID of the pool we want to inspect.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first set of number between brackets (column 17) is the active set of OSDs where the Placement Group is mapped.<br>
In the example above, the primary OSD is <code>7</code> and the secondary OSDs are <code>1</code> and <code>5</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now verify that all the Placement Groups of the new pool have active set with OSD IDs for <code>set1</code> as identified earlier.
In our test environment (0, 1, 5, 6, 7, 9).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">ceph pg dump | grep '^4.' | awk '{ print $17 }' | grep '\[[015679],[015679],[015679]\]' | wc -l</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Command details</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">grep '^4.' <i class="conum" data-value="1"></i><b>(1)</b>
awk '{ print $17 }' <i class="conum" data-value="2"></i><b>(2)</b>
grep '\[[015679],[015679],[015679]\]' <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Search for Placement Groups that belong to pool with ID 4</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Select the acting set column in the list returned</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the only possible values we look in each acting set</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">dumped all
32</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the configuration is correct the command should return a value of 32 has all the Placement Groups for
the pool should only use a set of active OSDs where all OSDs belong to <code>set1</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Disconnect from the <strong>toolbox</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">exit</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <a class="navbar-item" href="https://www.redhat.com/en/technologies/cloud-computing/openshift-container-storage" target="_blank">
      <img src="../../_/img/header_logo.svg" alt="Red Hat Data Services">
  </a>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
